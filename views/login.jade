extends layout

block content
  .container
    .row
      .col-md-6.col-md-offset-3
        .panel.panel-login
          .panel-heading
            .row
              .col-xs-6
                a#login-form-link.active(href='#') Login
              .col-xs-6
                a#register-form-link(href='#') Register
            hr
          .panel-body
            .row
              .col-lg-12
                form#login-form(action='users/login', method='post', role='form', style='display: block;')
                  .form-group
                    input#username.form-control(type='text', name='name', tabindex='1', placeholder='Username', value='')
                  .form-group
                    input#password.form-control(type='password', name='password', tabindex='2', placeholder='Password')
                  .form-group
                    .row
                      .col-sm-6.col-sm-offset-3
                        input#login-submit.form-control.btn.btn-login(type='submit', name='login-submit', tabindex='4', value='Log In')
                form#register-form(action='users/new', method='post', role='form', style='display: none;')
                  .form-group
                    input#username.form-control(type='text', name='name', tabindex='1', placeholder='Username', value='')
                  .form-group
                    input#email.form-control(type='email', name='email', tabindex='1', placeholder='Email Address', value='')
                  .form-group
                    input#password.form-control(type='password', name='password', tabindex='2', placeholder='Password')
                  .form-group
                    input#confirm-password.form-control(type='password', name='confirm-password', tabindex='2', placeholder='Confirm Password')
                  .form-group
                    .row
                      .col-sm-6.col-sm-offset-3
                        input#register-submit.form-control.btn.btn-register(type='submit', name='register-submit', tabindex='4', value='Register Now')
  
  script(src='/modules/jquery/dist/jquery.min.js')
  script(src='/modules/es6-promise/dist/es6-promise.auto.min.js')
  script(src='/modules/sweetalert2/dist/sweetalert2.min.js')
  script.
    $(function() {
      $('#login-form-link').click(function(e) {
        $("#login-form").delay(100).fadeIn(100);
        $("#register-form").fadeOut(100);
        $('#register-form-link').removeClass('active');
        $(this).addClass('active');
        e.preventDefault();
      });
      $('#register-form-link').click(function(e) {
        $("#register-form").delay(100).fadeIn(100);
        $("#login-form").fadeOut(100);
        $('#login-form-link').removeClass('active');
        $(this).addClass('active');
        e.preventDefault();
      });
      var form = document.getElementById('login-form');
      if (form.attachEvent) {
          form.attachEvent("submit", processLoginForm);
      } else {
          form.addEventListener("submit", processLoginForm);
      }
      form = document.getElementById('register-form');
      if (form.attachEvent) {
          form.attachEvent("submit", processRegForm);
      } else {
          form.addEventListener("submit", processRegForm);
      }
    });
    function processLoginForm(e) {
      if (e.preventDefault) e.preventDefault();
      alert("no submit login");
      return false;
    }
    function processRegForm(e) {
      if (e.preventDefault) e.preventDefault();
      var user = {
        name: e.target.name.value,
        email: e.target.email.value,
        password: e.target.password.value
      }
      var confirmPass = e.target['confirm-password'].value;
      if(!(user.name && user.email && user.password && confirmPass)){
        swal(
          'Fields cannot be empty.',
          'Ensure all fields are filled.',
          'error'
        );
        return false;
      }
      if(user.password === confirmPass){
        console.log(user);
        console.log("ajax");
        
        $.post( "users/new", user)
          .always(function( data, status ) {
            console.log("lol");
            console.log(status);
            var json = data.responseJSON;
            switch(status){
              case "error":
                var message = "Something went wrong. So wrong we don't know";
                if (json && json.message){
                  message = json.message;
                }
                swal(
                  'Something went wrong.',
                  message,
                  'error'
                );
                break;
              case "success":
                auth.saveToken(data.token);
                window.location.href = 'leaderboards';
            }
          });
      }
      else{
        swal(
          'Passwords don\'t match',
          'Ensure both fields are the same.',
          'error'
        );
      }
      /*$.post( "users/new", { name: "John", time: "2pm" })
        .done(function( data ) {
          alert( "Data Loaded: " + data );
        });*/
      return false;
    }
